<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/public.css" />
  <link rel="stylesheet" type="text/css" href="/css/my.css" />
  <link rel="stylesheet" type="text/css" href="/css/mypage.css" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
    crossorigin="anonymous"></script>
  <title>크크펀딩</title>
  <script src="/js/basic.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script>

    //숫자만 기입하면 -씌여지게 하는 함수
    function inputPhoneNumber(obj) {
      let number = obj.value.replace(/[^0-9]/g, "");
      let phone = "";
      if (number.length < 4) {
        return number;
      } else if (number.length < 7) {
        phone += number.substr(0, 3);
        phone += "-";
        phone += number.substr(3);
      } else if (number.substr(1, 1) === "2" && number.length < 10) {
        //case 02-xxx-xxxx
        phone += number.substr(0, 2);
        phone += "-";
        phone += number.substr(2, 3);
        phone += "-";
        phone += number.substr(5, 4);
      } else if (number.substr(1, 1) === "2" && number.length < 11) {
        phone += number.substr(0, 2);
        phone += "-";
        phone += number.substr(2, 4);
        phone += "-";
        phone += number.substr(6, 4);
      } else if (number.length < 11) {
        //case 010-xxx-xxxx, 031-xxx-xxxx
        phone += number.substr(0, 3);
        phone += "-";
        phone += number.substr(3, 3);
        phone += "-";
        phone += number.substr(6);
      } else { //010-xxxx-xxxx, 031-xxxx-xxxx
        phone += number.substr(0, 3);
        phone += "-";
        phone += number.substr(3, 4);
        phone += "-";
        phone += number.substr(7);
      }
      obj.value = phone;
    }
    function divPhoneNumber(num) {
      var phone = "";
      if (num.length < 10) {
        //case : 02-xxx-xxxx
        phone += num.substr(0, 2);
        phone += "-"
        phone += num.substr(2, 3);
        phone += "-"
        phone += str.substr(5, 4);
      } else if (num.substr(1, 1) === "2" && num.length === 10) {
        //case : 02-xxxx-xxxx
        phone += num.substr(0, 2);
        phone += "-"
        phone += num.substr(2, 4);
        phone += "-"
        phone += num.substr(6, 4);
      } else if (num.length === 10) {
        phone += num.substr(0, 3);
        phone += "-"
        phone += num.substr(3, 3);
        phone += "-"
        phone += num.substr(6, 4);
      } else if (num.length === 11) {
        phone += num.substr(0, 3);
        phone += "-"
        phone += num.substr(3, 4);
        phone += "-"
        phone += num.substr(7, 4);
      }
      return phone;
    }
    function update(jsonData) {
      var backurl = "http://localhost:9999/kkfd/member/";
      $.ajax({
        "method": "PUT",
        "url": backurl,
        "data": jsonData,
        "transformRequest": [null],
        "transformResponse": [null],
        "jsonpCallbackParam": "callback",
        "headers": {
          "Accept": "application/json, text/plain, */*",
          "Content-Type": "application/json;charset=utf-8"
        }, "xhrFields": {
          withCredentials: true
        }, "statusCode": {
          401: function () {
            alert('로그인후 사용해주세요');
            location.replace("/member/login");
          },
          500: function () {
            alert('서버에러, 관리자에게 문의해 주세요.');
          },
          200: function (responseObj) {
            alert("회원정보 수정성공");
            location.reload();
            $('div.mypage_name').text(responseObj.name);
            $('div.mypage_phone').text(responseObj.phone);
            $('input#phone').val(responseObj.phone);
            $('div.mypage_email').text(responseObj.email);
          },//end of 200
        }//end of statusCode
      });//end of Ajax
    }//end of function

    $(function () {
      var backurl = "http://localhost:9999/kkfd/member/";
      $.ajax({
        "method": "GET",
        "url": backurl,
        "transformRequest": [null],
        "transformResponse": [null],
        "jsonpCallbackParam": "callback",
        "headers": {
          "Accept": "application/json, text/plain, */*"
        }, "xhrFields": {
          withCredentials: true
        },
        "timeout": {},
        "statusCode": {
          401: function () {
            alert('로그인후 사용해주세요');
            location.replace("/member/login");
          },
          500: function () {
            alert('서버에러, 관리자에게 문의해 주세요.');
          },
          200: function (responseObj) {
            var phone = divPhoneNumber(responseObj.phone);
            $('div.mypage_name').text(responseObj.name);
            $('div.mypage_phone').text(phone);
            $('input#phone').val(responseObj.phone);
            $('div.mypage_email').text(responseObj.email);
          },//end of 200
        }//end of statusCode
      });//end of Ajax

      //비밀번호 유효성검사
      var regex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!^%*#?&]{8,16}$/;
      $('input#pwd1').keyup(function () {
        $('#message2').show();
        if (false === regex.test($(this).val())) {
          $('#message2').text('8~16자 영문 대 소문자, 숫자, 특수문자를 사용하세요.');
        } else {
          $('#message2').css("color", "green");
          $('#message2').text('사용 가능');
        }
      });


      //핸드폰번호 -빼고 db에전송
      $('button#phoneUp').click(function () {
        var phoneDate = "";
        var $phone = $('input#phone');
        if ($phone.val().length < 12) {
          //case : 02-xxx-xxxx
          phoneDate += $phone.val().substr(0, 2);
          phoneDate += $phone.val().substr(3, 3);
          phoneDate += $phone.val().substr(7, 4);
        } else if ($phone.val().substr(1, 1) === "2" && $phone.val().length === 12) {
          //case : 02-xxxx-xxxx
          phoneDate += $phone.val().substr(0, 2);
          phoneDate += $phone.val().substr(3, 4);
          phoneDate += $phone.val().substr(8, 4);
        } else if ($phone.val().length === 12) {
          phoneDate += $phone.val().substr(0, 3);
          phoneDate += $phone.val().substr(4, 3);
          phoneDate += $phone.val().substr(8, 4);
        } else if ($phone.val().length === 13) {
          phoneDate += $phone.val().substr(0, 3);
          phoneDate += $phone.val().substr(4, 4);
          phoneDate += $phone.val().substr(9, 4);
        }
        var data = '{"phone" : "' + phoneDate + '"}';
        update(data);
        return false;
      });
      /*
            //핸드폰번호 유효성검사 후 수정 요청
            $('button#phoneUp').click(function () {
              var phone = $('input#phone').val()
              var patternPhone = /01[016789]-[^0][0-9]{2,3}-[0-9]{3,4}/;
              if (!patternPhone.test(phone)) {
                alert('핸드폰 번호를 확인 해주세요');
                $('input#phone').focus();
                return false;
              }
              var data = '{"phone" : "' + phone + '"}'
              update(data);
              return false;
            });
      */
      //비밀번호 유효성 검사 후 수정 요청
      $('form#pwdUp').submit(function () {
        if ($('input#pwd1').val() != $('input#pwd2').val()) {
          alert("비밀번호 불일치");
          ($('input#pwd2').focus());
          return false;
        }
        if ($('#message2').text() != '사용 가능') {
          alert("비밀번호 형식x")
            ($('input#pwd1').focus());
          return false;
        }
        var data = '{"pwd" : "' + $('input#pwd1').val() + '"}';
        console.log(data);
        update(data);
        return false;
      });

      //이메일 수정 요청
      $('button#emailUp').click(function () {
        var email = $('input#email1').val() + '@';
        if ($('select#email3').val() != 1) {
          email += $('select#email3').val();
        } else {
          email += $('input#email2').val();
        }
        console.log(email);
        var data = '{"email" : "' + email + '"}'
        console.log(data);
        update(data);
        return false;
      });

      $('select#email3').change(function () {
        var $email2 = $('input#email2');
        if ($(this).val() == "1") {
          $email2.show();
          $(this).width(20);
        } else {
          $email2.hide();
          $(this).width(210);
        }
      });

      var $changeBtn = $('div.mypage_modify > div.mypage_title_container > button.mypage_change_btn');
      $changeBtn.click(function () {
        var $before = $(this).parent().next();//이전 정보
        var $after = $(this).parent().next().next();//input_box
        if ($before.css("display") == "block") {
          $before.hide();
          $after.show();
        } else {
          $before.show();
          $after.hide();
        }
      });
    });
  </script>
</head>

<body>
  <!-- header -->
  <header class="main_header">
    <div class="main_header_warp">
      <div class="header_menu_warp">
        <div class="header_projectsearch">
          <button class="projectsearch_item">
            <a style="text-decoration: none; color: black" href="/project/list/">
              <i class="fas fa-align-justify fa-lg"></i>
              <span class="projectsearch_name">프로젝트 둘러보기</span>
            </a>
          </button>
        </div>
        <div class="header_projectupload">
          <a style="text-decoration: none;" href="/register/registerAgree/">
            <span class="projectupload_name">프로젝트 올리기</span>
          </a>
        </div>
      </div>
      <div class="header_mainlogo">
        <a style="text-decoration: none;" href="/">
          <span class="header_mainlogo_item">크크펀딩</span>
        </a>
      </div>
      <div class="header_sub_warp">
        <div class="header_searchicon">
          <!-- <i class="fas fa-search fa-lg"></i> -->
        </div>
        <div class="header_customer_warp">
          <button class="header_customer_btn">
            <div class="header_login&signup">
              <span class="login_signup_name">
                <a class="admin-no" href="/member/login">로그인 / 회원가입</a>
                <a class="admin-yes" href="/creator/cmypage">마이페이지</a>
                <a class="admin-yes" href="javascript:Logout()">로그아웃</a>
              </span>
            </div>

          </button>
        </div>
      </div>
    </div>
  </header>
  <!-- 메인섹션 -->
  <section class="main_section">
    <div class="my">
      <div class="toptitle">
        <h3>마이페이지</h3>
      </div>
      <div class="topnav">
        <a class="member_active" href="/member/mypage">회원정보수정</a>
        <a class="member" href="/member/funlist">펀딩한 프로젝트</a>
        <a class="member" href="/project/bmlist">북마크한 프로젝트</a>
        <a class="creator" href="/creator/cmypage">크리에이터 프로필수정</a>
        <a class="creator" href="/creator/mylist">마이 프로젝트</a>
      </div>
      <!--[회원정보 수정]-->
      <div class="mypage">
        <div class="mypage_left">
          <div class="mypage_modify">
            <div class="mypage_title_container">
              <span class="mypage_title">이름</span>
            </div>
            <div class="mypage_name">
              <!--이름-->
            </div>
          </div>
          <div class="mypage_modify">
            <div class="mypage_title_container">
              <span class="mypage_title">비밀번호</span><button class="mypage_change_btn">변경</button>
            </div>
            <div class="mypage_input_box">
              <form id="pwdUp">
                <input type="password" id="pwd1" maxlength="50" class="mypage_input pwd" required />
                <div id="message2" style="display: none;"></div>
                <input type="password" id="pwd2" maxlength="50" class="mypage_input pwd" />
                <div id="message3" style="display: none;"></div>
                <div><button type="submit" class="mypage_save_btn">저 장</button></div>
              </form>
            </div>
          </div>
          <div class="mypage_modify">
            <div class="mypage_title_container">
              <span class="mypage_title">휴대전화</span><button class="mypage_change_btn">변경</button>
            </div>
            <div class="mypage_phone">
              <!--이전 휴대전화 번호-->
            </div>
            <div class="mypage_input_box">
              <input type="text" id="phone" maxlength="13" class="mypage_input" onkeyup="inputPhoneNumber(this);" />
              <div><button type="button" id="phoneUp" class="mypage_save_btn">저 장</button></div>
            </div>
          </div>

          <div class="mypage_modify">
            <div class="mypage_title_container">
              <span class="mypage_title">이메일</span><button class="mypage_change_btn">변경</button>
            </div>
            <div class="mypage_email">
              <!--이전이메일-->
            </div>
            <div class="mypage_input_box">
              <div class="email_container">
                <input type="text" id="email1" class="mypage_input_email" maxlength="25">
                <span>&nbsp;&nbsp;@&nbsp;</span>
                <input type="text" id="email2" class="mypage_input_email" maxlength="10">
                <select id="email3" class="mypage_input_email">
                  <option value="1">직접입력</option>
                  <option value="naver.com" selected>naver.com</option>
                  <option value="gmail.com">gmail.com</option>
                  <option value="hanmail.com">hanmail.com</option>
                  <option value="hotmail.com">hotmail.com</option>
                  <option value="nate.com">nate.com</option>
                  <option value="yahoo.co.kr">yahoo.co.kr</option>
                  <option value="empas.com">empas.com</option>
                  <option value="dreamwiz.com">dreamwiz.com</option>
                  <option value="freechal.com">freechal.com</option>
                  <option value="lycos.co.kr">lycos.co.kr</option>
                  <option value="korea.com">korea.com</option>
                  <option value="gmail.com">gmail.com</option>
                  <option value="hanmir.com">hanmir.com</option>
                  <option value="paran.com">paran.com</option>
                </select>
              </div>
              <div><button type="button" id="emailUp" class="mypage_save_btn">저 장</button></div>
            </div>
          </div>
        </div>
        <div class="mypage_right">
          <div class="mypage_creator_profile">
            <div class="mypage_creator_top">개인정보는 어떻게 쓰이나요?</div>

            <div class="mypage_creator_intro">
              이름,전화번호,이메일 등과 같은 개인 개인 정보는 펀딩한 프로젝트가 성공했을때 크리에이터가 조회 할 수 있습니다.
            </div>
          </div>
        </div>
      </div>

  </section>
  <footer class="main_footer">

    <div class="footer_second_warp">
      <div class="footer_info_warp">
        <div class="info_first_warp">
          <span class="info_item1">회사명</span>
          <span class="info_item2">크크펀딩</span>
          <span class="info_item1">주소</span>
          <span class="info_item2">경기도 성남시 분당구 성남대로 34 6층(구미동 하나프라자빌딩)</span>
          <span class="info_item1">대표</span>
          <span class="info_item2">오문정</span>
          <span class="info_item1">사업자등록번호</span>
          <span class="info_item2">105-87-52823</span>
        </div>
        <div class="info_second_warp">
          <span class="info_item1">통신판매업 신고번호</span>
          <span class="info_item2">2019-3010165-30-2-02129</span>
          <span class="info_item1">대표번호</span>
          <span class="info_item2">031-606-9319</span>
        </div>
        <div class="info_last_warp">
          <span class="last_warp_item">© 2021 KKPD Inc.</span>
        </div>
      </div>
      <div class="footer_info_icon">
        <i class="fab fa-java fa-lg"></i>
        <i class="fab fa-js fa-lg"></i>
        <i class="fab fa-html5 fa-lg"></i>
        <i class="fab fa-css3 fa-lg"></i>
        <i class="fas fa-user-md fa-lg"></i>
        <i class="fas fa-head-side-mask fa-lg"></i>
      </div>
    </div>
    <div class="footer_last_info">
      <div class="footer_last_info_div">
        <span class="last_info_item">
          크크펀딩은 플랫폼 제공자로서 프로젝트의 당사자가 아니며, 직접적인 통신판매를 진행하지 않습니다. 프로젝트의 완수 및 선물제공의 책임은 해당 프로젝트의 창작자에게 있으며, 프로젝트와 관련하여 후원자와
          발생하는 법적 분쟁에 대한 책임은 해당 창작자가 부담합니다.
        </span>
      </div>
    </div>
  </footer>
  <script>
    logouted();
    checkLogined();
  </script>
</body>

</html>