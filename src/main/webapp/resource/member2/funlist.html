<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="/css/public.css" />
    <link rel="stylesheet" type="text/css" href="/css/my.css" />
    <link rel="stylesheet" type="text/css" href="/css/funlist.css" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
      crossorigin="anonymous"
    ></script>
    <title>크크펀딩</title>
    <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
      //천단위 쉼표
      function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      }
      function getUrlParams() {
        var params = {};

        window.location.search.replace(
          /[?&]+([^=&]+)=([^&]*)/gi,
          function (str, key, value) {
            params[key] = value;
          }
        );

        return params;
      }
      function funlist(no) {
        var $form = $("form#criteria");
        $form.find("input[name=page]").val(no);
        var backurl = "http://localhost:9999/kkfd/fundings/";
        var data = $form.serialize();
        $.ajax({
          url: backurl,
          method: "GET",
          data: data,
          success: function (responseObj) {
            var $trObj = $("body > section > div.my > table.allFun tr.data"); //tr class가 data인 객체들
            $(responseObj.list).each(function (i, f) {
              var $trCopyObj = $trObj.clone(); //tr 복제본객체
              $trCopyObj.show();
              $trCopyObj.find("th.projNo").html(f.projNo);
              $trCopyObj
                .find("a.projTitle")
                .html(p.projTitle)
                .attr("href", "/project/info?no=" + p.projNo);
              $trCopyObj.find("td.term").html(p.projStart + "~" + p.projEnd);

              switch (p.projStatus) {
                case 0: //취소 : 빨강 기간에 취소선
                  $trCopyObj
                    .find("div.state")
                    .addClass("bg-danger")
                    .addClass("text-white")
                    .html("취소");
                  $trCopyObj
                    .find("td.term")
                    .addClass("text-decoration-line-through");
                  break;
                case 10: //예정 : 회색
                  $trCopyObj
                    .find("div.state")
                    .addClass("bg-secondary")
                    .addClass("text-white")
                    .html("예정");
                  break;
                case 20: //실패 : 노랑 모집금액에 취소선
                  $trCopyObj
                    .find("div.state")
                    .addClass("bg-warning")
                    .addClass("text dark")
                    .html("실패");
                  $trCopyObj
                    .find("td.totalFm")
                    .addClass("text-decoration-line-through")
                    .html(numberWithCommas(totalFm + "원"));
                  break;
                case 21: //성공 : 초록 모집금액 표시, 참여자 보기 버튼
                  $trCopyObj
                    .find("div.state")
                    .addClass("bg-success")
                    .addClass("text-white")
                    .html("성공");
                  $trCopyObj
                    .find("td.totalFm")
                    .html(numberWithCommas(totalFm + "원"));
                  var btnCopyObj = $btnObj.clone();
                  btnCopyObj
                    .show()
                    .val(p.projNo)
                    .attr(
                      "onClick",
                      "location.href='/project2/joinlist?no=" + p.projNo + "'"
                    );
                  $trCopyObj.find("td.view").append(btnCopyObj);
                  break;
                default:
                  //진행예정,진행 : 파랑 모집금액 표시
                  $trCopyObj
                    .find("div.state")
                    .addClass("bg-primary")
                    .addClass("text-white")
                    .html("진행");
                  $trCopyObj
                    .find("td.totalFm")
                    .html(numberWithCommas(totalFm + "원"));
                  break;
              }
              $trObj.parent().append($trCopyObj);
            }); //end of each

            var cPage = responseObj.currentPage;
            var tPage = responseObj.totalPage;
            var sPage = responseObj.startPage;
            var ePage = responseObj.endPage;
            var url = responseObj.url;

            var $pageLi = $(
              "div.pagination_container>ul.pagination"
            ).children(); //a태그 포함한 li
            var $prevLi = $pageLi.first();
            var $nextLi = $pageLi.last();
            if (cPage == 1) {
              $prevLi.addClass("disabled");
              $prevLi.find("a.page-link").attr("aria-disabled", true);
            } else {
              $prevLi.removeClass("disabled");
              $prevLi
                .find("a.page-link")
                .attr("aria-disabled", false)
                .attr("href", url + (cPage - 1));
            }
            if (cPage == tPage) {
              $nextLi.addClass("disabled");
              $nextLi.find("a.page-link").attr("aria-disabled", true);
            } else {
              $nextLi.removeClass("disabled");
              $nextLi
                .find("a.page-link")
                .attr("aria-disabled", false)
                .attr("href", url + (cPage + 1));
            }
            var $liObj = $pageLi.eq(1);
            $pageLi.parent().find("li.num").not(":first").remove(); //안보이는 원본li객체는 남기고 삭제
            for (let k = sPage; k <= ePage; k++) {
              $liCopyObj = $liObj.clone();
              $liCopyObj.show();
              $liCopyObj
                .find("a.page-link")
                .html(k)
                .attr("href", url + k);
              if (k == cPage) {
                $liCopyObj.addClass("active").attr("aria-current", "page");
              }
              $nextLi.before($liCopyObj);
            } //end of for
          }, //end of success
          error: function (jqXHR, textStatus) {}, //end of error
        }); //end of Ajax
      }

      $(function () {
        $("div.pagination_container>ul.pagination").on(
          "click",
          "li.page-item > a.page-link",
          function () {
            var page = $(this).attr("href");
            $.ajax({
              url: backurl,
              method: "GET",
              transformRequest: [null],
              transformResponse: [null],
              jsonpCallbackParam: "callback",
              headers: {
                Accept: "application/json, text/plain, */*",
              },
              timeout: {},
              success: function (responseObj) {
                mylist(responseObj);
              }, //end of success
              error: function (jqXHR, textStatus) {}, //end of error
            }); //end of Ajax
            return false;
          }
        ); //end of function;
      }); //end of load;
    </script>
  </head>

  <body>
    <!-- header -->
    <header class="main_header">
      <div class="main_header_warp">
        <div class="header_menu_warp">
          <div class="header_projectsearch">
            <button class="projectsearch_item">
              <a style="text-decoration: none; color: black" href="/project/">
                <i class="fas fa-align-justify fa-lg"></i>
                <span class="projectsearch_name">프로젝트 둘러보기</span>
              </a>
            </button>
          </div>
          <div class="header_projectupload">
            <a style="text-decoration: none" href="/register/registerAgree/">
              <span class="projectupload_name">프로젝트 올리기</span>
            </a>
          </div>
        </div>
        <div class="header_mainlogo">
          <a style="text-decoration: none" href="/">
            <span class="header_mainlogo_item">크크펀딩</span>
          </a>
        </div>
        <div class="header_sub_warp">
          <div class="header_searchicon">
            <!-- <i class="fas fa-search fa-lg"></i> -->
          </div>
          <div class="header_customer_warp">
            <button class="header_customer_btn">
              <div class="header_login&signup">
                <span class="login_signup_name">
                  <a href="/member/login">로그인 / 회원가입</a>
                </span>
              </div>
              <div class="header_profile_img">
                <img class="profile" src="/img/blank.png" />
              </div>
            </button>
          </div>
        </div>
      </div>
    </header>
    <!-- 메인섹션 -->
    <section class="main_section">
      <div class="my">
        <div class="toptitle">
          <h3>마이페이지</h3>
        </div>
        <div class="topnav">
          <a class="member" href="/member/mypage">회원정보수정</a>
          <a class="member_active" href="/member/funlist">펀딩한 프로젝트</a>
          <a class="member" href="/project/bmlist">북마크한 프로젝트</a>
          <a class="creator" href="/creator/cmypage">크리에이터 프로필수정</a>
          <a class="creator" href="/creator/mylist">마이 프로젝트</a>
        </div>
        <div class="d-flex justify-content-around">
          <input
            type="radio"
            class="btn-check"
            name="options"
            id="option1"
            autocomplete="off"
            checked
          />
          <span>기간선택</span>
          <label class="btn btn-secondary" for="month1">1개월</label>
          <input
            type="radio"
            class="btn-check"
            name="term"
            id="option2"
            autocomplete="off"
          />
          <label class="btn btn-primary" for="month3">3개월</label>
          <input
            type="radio"
            class="btn-check"
            name="term"
            id="option3"
            autocomplete="off"
          />
          <label class="btn btn-secondary" for="month6">6개월</label>
          <input
            type="radio"
            class="btn-check"
            name="term"
            id="option4"
            autocomplete="off"
          />
          <label class="btn btn-secondary" for="option4">12개월</label>
          <span>상태선택</span>
        </div>

        <table class="table allFun">
          <thead class="table-light">
            <tr>
              <th scope="col" width="5%">번호</th>
              <th scope="col" width="8%">신청일</th>
              <th scope="col" width="30%">프로젝트명</th>
              <th scope="col" width="8%">펀딩금액</th>
              <th scope="col" width="8%">목표도달</th>
              <th scope="col" width="8%">마감일</th>
              <th scope="col" width="8%">배송예정일</th>
              <th scope="col" width="8%">운송장번호</th>
            </tr>
          </thead>
          <tbody>
            <tr class="data" style="display: none">
              <th scope="row" class="funNo"></th>
              <td class="funDate"></td>
              <td><a class="projTitle text-decoration-none"></a></td>
              <td class="ext-end funFm"></td>
              <td class="text-center status">
                <div class="status"></div>
              </td>

              <td class="projEnd"></td>
              <td class="funDelivery"></td>
              <td class="funTrack"></td>
            </tr>
          </tbody>
        </table>

        <div class="pagination_container">
          <ul class="pagination">
            <li class="page-item">
              <a class="page-link" tabindex="-1">&laquo;</a>
            </li>
            <li class="num page-item" style="display: none">
              <a class="page-link"></a>
            </li>
            <li class="page-item">
              <a class="page-link">&raquo;</a>
            </li>
          </ul>
        </div>
      </div>
    </section>
    <footer class="main_footer">
      <div class="footer_second_warp">
        <div class="footer_info_warp">
          <div class="info_first_warp">
            <span class="info_item1">회사명</span>
            <span class="info_item2">크크펀딩</span>
            <span class="info_item1">주소</span>
            <span class="info_item2"
              >경기도 성남시 분당구 성남대로 34 6층(구미동 하나프라자빌딩)</span
            >
            <span class="info_item1">대표</span>
            <span class="info_item2">오문정</span>
            <span class="info_item1">사업자등록번호</span>
            <span class="info_item2">105-87-52823</span>
          </div>
          <div class="info_second_warp">
            <span class="info_item1">통신판매업 신고번호</span>
            <span class="info_item2">2019-3010165-30-2-02129</span>
            <span class="info_item1">대표번호</span>
            <span class="info_item2">031-606-9319</span>
          </div>
          <div class="info_last_warp">
            <span class="last_warp_item">© 2021 KKPD Inc.</span>
          </div>
        </div>
        <div class="footer_info_icon">
          <i class="fab fa-java fa-lg"></i>
          <i class="fab fa-js fa-lg"></i>
          <i class="fab fa-html5 fa-lg"></i>
          <i class="fab fa-css3 fa-lg"></i>
          <i class="fas fa-user-md fa-lg"></i>
          <i class="fas fa-head-side-mask fa-lg"></i>
        </div>
      </div>
      <div class="footer_last_info">
        <div class="footer_last_info_div">
          <span class="last_info_item">
            크크펀딩은 플랫폼 제공자로서 프로젝트의 당사자가 아니며, 직접적인
            통신판매를 진행하지 않습니다. 프로젝트의 완수 및 선물제공의 책임은
            해당 프로젝트의 창작자에게 있으며, 프로젝트와 관련하여 후원자와
            발생하는 법적 분쟁에 대한 책임은 해당 창작자가 부담합니다.
          </span>
        </div>
      </div>
    </footer>
  </body>
</html>
